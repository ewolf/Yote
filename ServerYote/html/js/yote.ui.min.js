if(yote){var _costForm=new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2,style:"decimal"}),_makeFormatter=function(a){return new Intl.NumberFormat("en-US",{minimumFractionDigits:a,maximumFractionDigits:a,style:"decimal"})},_updater=function(a){$(".toggleField").each(function(){var b=a,c=$(this);if(c.data("id")==b.id){var d=c.data("field"),e=c.data("toggle-class"),f=a.get(d),g=void 0===f||0==f?!1:!0;c.toggleClass(e,g)}}),$(".showField").each(function(){var b=a,c=$(this);if(c.data("id")==b.id){var d=c.data("field"),e=a.get(d),f=c.data("format");if(f&&("$"==f?e=_costForm.format(e):f.startsWith("#")&&(e=_makeFormatter(c.data("format").substr(1)).format(e))),c.is("input")){{c.attr("type")}"checkbox"===c.attr("type")?"1"===e?c.prop("checked",!0):c.prop("checked",!1):c.attr("value",e)}else c.is("select")?c.val("object"==typeof e?e.id:e):c.is("img")?c.attr("src",e):e?c.text(e):c.html("&nbsp;")}})};yote.ui={energize:function(a,b){yote.ui.setIds(a,b),yote.ui.activateControls(),yote.ui.watchForUpdates(b)},fill_template:function(a,b,c){function d(a){for(var d=0;d<c.length;d++){var e=c[d];"undefined"!=typeof b[a.attr(e)]&&a.attr(e,b[a.attr(e)])}}c||(c=[]),b||(b=[]);var e=$("section.templates "+a+'[data-cloned!="true"]');if(e.length>1)return void console.warn("error filling template '"+a+"'. selector matches somethign other than one thing.");if(0==e.length)return void console.warn("error filling template '"+a+"'. could not find template.");var f=e.clone();return f.data("cloned","true"),d(f),f.find("*").each(function(){d($(this))}),f},setIds:function(a,b){$("."+a+",."+a+"-child").each(function(){var c=$(this);c.data("activated-listeners",!1),c.data("activated-controls",!1),c.is("select")&&c.data("id")!=b.id&&c.removeClass("build-select"),c.hasClass(a+"-child")&&c.data("parent",b.id),c.hasClass(a)&&c.data("id",b.id)})},updateListener:function(a,b,c,d){a[b]||(a[b]=!0,a.addUpdateListener(c)),d&&c(a)},onControl:function(a,b,c){$(a).each(function(a,d){var e=$(d);$.contains($(".templates")[0],d)||e.data(b)||e.data("activated-controls")||!e.data("id")||(e.data(b,!0),e.data("activated-controls",!0),c(e))})},addListener:function(a,b,c){$(a).each(function(a,d){var e=$(d);if(!$.contains($(".templates")[0],d)&&!e.data(b)&&!e.data("activated-listeners")&&e.data("id")){e.data(b,!0),e.data("activated-listeners",!0);for(var f in c)e.off(f,c[f]).on(f,c[f])}})},activateControls:function(){yote.ui.onControl("div.updateFieldControl","updateField-setup",function(a){var b='data-id="'+a.data("id")+'"';a.empty().append('<div class="editing-area"><textarea class="updateField showField '+(a.data("classes")||"")+'" '+b+'       data-field="'+a.data("field")+'"></textarea><br><button type="button" '+b+' class="cancel">cancel</button> <button type="button" '+b+' class="ok">ok</button></div><pre><span class="showField '+(a.data("classes")||"")+'"'+b+'      data-format="'+a.data("format")+'"      data-field="'+a.data("field")+'">  &nbsp;</span></pre>');var c=yote.fetch(a.data("id")),d=a.data("field"),e=c.get(d);a.data("original",e)}),yote.ui.onControl("select.updateField","build-select",function(a){var b=yote.fetch(a.data("id")),c=a.data("field"),d=b.get(c);"object"===a.data("var-is")&&d&&(d=d.id),a.data("original",d);var e,f=a.data("src-id"),g=function(){for(var b="",c=0;c<e.length;c++){var f,g,h=e[c];Array.isArray(h)?(g=h[0],f=h[1]):(g=h,f=h);var i="";"object"==typeof g&&(g=g.id,i='data-id="'+g+'" data-field="name" '),"object"==typeof f&&(f=f.get("name")),b+='<option class="showField" '+i+' value="'+g+'">'+f+"</option>"}a.empty().append(b).val(d),!b&&a.data("hide-on-empty")?a.hide():a.show()},h=f?yote.fetch(f):b;if(a.data("src-field")){var i=h.get(a.data("src-field"));e=i.toArray(),g(),yote.ui.updateListener(i,"select-chooser-build-select",function(){var b="build-select";a.data(b,!1)},!1)}"undefined"!=typeof c&&a.off("change").on("change",function(){var d=a.val();"object"===a.data("var-is")&&(d=yote.fetch(d));var e={};e[c]=d,b.update([e])})}),yote.ui.addListener("div.updateFieldControl","updateField-click",{click:function(a){a.preventDefault();var b=$(this);b.addClass("editing");var c=b.find("input");c.data("original",c.val()),c.focus()}}),yote.ui.addListener("div.updateFieldControl>.editing-area>textarea","keylisteners",{blur:function(){var a=$(this);a.data("original")==a.val()&&a.parent().parent().removeClass("editing")},keydown:function(a){var b=a.keyCode||a.charCode,c=$(this);if(27==b){var d=c.parent().parent();c.val(d.data("original")||""),d.removeClass("editing"),c.removeClass("edited")}c.toggleClass("edited",c.data("original")==c.text())},keyup:function(){var a=$(this);a.toggleClass("edited",a.data("original")!=a.text())}}),yote.ui.addListener(".ok","okclick",{click:function(a){a.preventDefault(),a.stopPropagation();var b=$(this).parent().parent(),c=b.find("textarea");b.find("span").text(c.text()),c.removeClass("edited"),b.removeClass("editing");var d=yote.fetch(c.data("id")),e=c.data("field"),f={};f[e]=c.val(),b.data("original",f[e]),d.update([f])}}),yote.ui.addListener(".cancel","cancelclick",{click:function(a){a.preventDefault(),a.stopPropagation();var b=$(this).parent().parent(),c=b.find("textarea");c.val(b.data("original")||""),b.removeClass("editing"),c.removeClass("edited")}}),yote.ui.addListener('input.updateField[type="checkbox"]',"checked",{change:function(){var a=$(this),b=yote.fetch(a.data("id")),c=a.data("field"),d={};d[c]=a.is(":checked")?1:0,b.update([d])}}),yote.ui.addListener("input.updateField","input-keydown",{keydown:function(a){var b=a.keyCode||a.charCode;if(13==b||9==b){var c=$(this),d=yote.fetch(c.data("id")),e=c.data("field"),f={};f[e]=c.val(),d.update([f])}}}),yote.ui.addListener(".updateField.autosubmit","input-blur",{blur:function(){var a=$(this),b=yote.fetch(a.data("id")),c=a.data("field"),d={};d[c]=a.val(),b.update([d])}}),yote.ui.addListener(".delAction","delAction",{click:function(a){a.preventDefault();var b=$(this);if(!b.data("needs-confirmation")||confirm(b.data("delete-message")||"really delete?")){var c=yote.fetch(b.data("parent")),d=yote.fetch(b.data("id"));c.remove_entry([d,b.data("from")])}}}),yote.ui.addListener(".addAction","addClick",{click:function(a){a.preventDefault();var b=$(this),c=b.data("list"),d=yote.fetch(b.data("id"));d.add_entry([c],function(a){yote.ui.watchForUpdates(Array.isArray(a)?a[0]:a)})}}),yote.ui.addListener(".action","addAction",{click:function(a){a.preventDefault();var b=$(this),c=b.data("action"),d=[];b.data("param")&&d.push(yote.fetch(b.data("param")));var e=yote.fetch(b.data("id"));e[c](d)}})},setup_table:function(a){var b=$(a.conSel).find("tbody");b.empty();var c=a.list||a.listOn.get(a.listName);c.each(function(c,d){var e="function"==typeof a.replaceList?a.replaceList(c,d):a.replaceList,f=yote.ui.fill_template(a.rowSel,e||{ID:c.id,FROMID:a.listOn.id},a.fieldList||["id","parent"]);b.append(f),a.onEachRow&&a.onEachRow(f,c,d),yote.ui.watchForUpdates(c)}),yote.ui.activateControls(),c.each(function(a){yote.ui.watchForUpdates(a)})},setup_container:function(a){var b=$(a.conSel);if(a.isTable){var c=b.find("tbody");c&&(b=c)}b.empty();var d=a.list||a.listOn.get(a.listName);d.each(function(c,d){var e="function"==typeof a.replaceList?a.replaceList(c,d):a.replaceList,f=yote.ui.fill_template(a.rowSel,e||{ID:c.id,FROMID:a.listOn.id},a.fieldList||["id","parent"]);b.append(f),a.onEachRow&&a.onEachRow(f,c,d),yote.ui.watchForUpdates(c)}),yote.ui.activateControls(),d.each(function(a){yote.ui.watchForUpdates(a)})},watchForUpdates:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];b._watched||(b.addUpdateListener(_updater),b._watched=!0),_updater(b)}}}}
/* {"sources":{"yote.ui.js":"0b9dd7e7f97bd7238c9e966ea769d1b6"}} */