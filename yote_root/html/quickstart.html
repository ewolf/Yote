<!doctype html>
<html>
  <head>
    <title>Yote Quickstart</title>
    <script src="/yote/js/jquery-latest.js"></script>
    <script src="/yote/js/jquery.dumper.js"></script>
    <script src="/yote/js/jquery.cookie.js"></script>
    <script src="/yote/js/jquery.base64.min.js"></script>
    <script src="/yote/js/json2.js"></script>
    <link href="/css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
    <link href="/css/bootstrap-responsive.css" rel="stylesheet" type="text/css" media="all" />


    <script src="/js/main.js"></script>
    <script src="/yote/js/yote.js"></script>
    <script src="/yote/js/yote.util.js"></script>
    <link rel="stylesheet" href="/yote/css/jquery.mobile.css" type="text/css" media="all" />
    <link rel="stylesheet" href="/yote/css/ui-lightness/jquery-ui-1.8.23.custom.css" type="text/css" media="all" />
    <link href="/yote.css" rel="stylesheet" type="text/css" media="all" />
    <link href="/css/main.css" rel="stylesheet" type="text/css" media="all" />
    <script>
    $().ready(function(){

	make_menus( '#top_nav' );

	$.yote.init();
	
	if( false ) {
	    var hello_app = $.yote.fetch_app('Yote::Test::Hello');
	    alert( hello_app.hello_scalar() );
	    var yote_list = hello_app.hello_array();
	    for( var i=0; i < yote_list.length(); i++ ) {
		alert( yote_list.get( i ) );
	    }
	    var yote_hash = hello_app.hello_hash();
	    var hash_keys = yote_hash.keys();
	    for( var i=0; i < hash_keys.length; i++ ) {
		var hk = hash_keys[ i ];
		alert( hk + ' --> ' + yote_hash.get( hk ) );
	    }
	    alert( hello_app.hello_nothing() );
	}

	var lesson_template = {
	    title             : '',
	    summary           : '',
	    client            : '',
	    server            : '',
	    discussion        : '',
	    server_discussion : '',
	    client_discussion : ''
	};


	var lessons = [
	    // ******************* HELLO WORLD *****************
	    {
		title   : 'Hello World',
		summary : 'Connect client to server',
		client  : '\
$.yote.init();\n\
var hello_app = $.yote.fetch_app(\'Yote::Hello\');\n\
alert( hello_app.hello() );',
		server : '\
package Hello;\n\
use base \'Yote::AppRoot\';\n\
\n\
sub hello {\n\
  return "Hello World";\n\
}',
		discussion : 'This kata shows how perl app methods can be invoked from the client side.',
		server_discussion : 'All Apps inherit from Yote::AppRoot and have a singleton object associated with them.',
		client_discussion : 'Once yote is initialized, an app singleton object is obtained by calling fetch_app.'
	    },

	    // ******************* HELLO OUTPUTS *****************
	    {
		title             : 'Hello Outputs',
		summary           : 'Show four of the five output types that the server can emit to the client.',
		client            : '\
$.yote.init();\n\
var hello_app = $.yote.fetch_app(\'Yote::Hello\');\n\
alert( hello_app.hello_scalar() );\n\
var yote_list = hello_app.hello_array();\n\
for( var i=0; i < yote_list.length(); i++ ) {\n\
   alert( yote_list.get( i ) );\n\
}\n\
var yote_hash = hello_app.hello_hash();\n\
var hash_keys = yote_hash.keys();\n\
var hash_keys = yote_hash.keys();\n\
for( var i=0; i < hash_keys.length; i++ ) {\n\
  var hk = hash_keys[ i ];\n\
  alert( hk + \' --> \' + yote_hash.get( hk ) );\n\
}\n\
alert( hello_app.hello_nothing() );',
		server            : '\
package Hello;\n\
use base \'Yote::AppRoot\';\n\
\n\
sub hello_scalar {\n\
  return "Hello"\n\
}\n\
sub hello_array {\n\
  return [ "A", "B", 33 ];\n\
}\n\
sub hello_hash {\n\
  return { Foo => "BAR", \n\
           Baz => "BAF" }\n\
}\n\
sub hello_nothing {}',
		discussion        : 'This kata shows how scalar, array and hash outputs are passed from the client to the server. It\'s very important to note that arrays and hashes returned are not javascript arrays and hashes, but are array and has like objects.',
		server_discussion : 'The server can pass back undef, scalars, arrays, hashes and yote objects.  Yote objects are not seen here. They will be covered in a later lesson',
		client_discussion : 'It\'s very important to note that hashes and arrays are returned to the client as javascript objects that are not hash nor array. The array has a length() <strong>method</strong> rather than a length <i>property</i>. Items are extracted from these javascript objects using <strong>get( index or key )</strong>.'
	    },

	    // ******************* HELLO INPUTS *****************
	    {
		title   : 'Hello Inputs',
		summary : 'Discover three out of four of the input types the client can pass to the server',
		client  : '\
$.yote.init();\n\
var hello_app = $.yote.fetch_app(\'Yote::Hello\');\n\
alert( hello_app.hello(\'Bob\') );\n\
alert( hello_app.list_length( [ \'A\', \'B\', \'C\' ] ));\n\
alert( hello_app.hash_keycount( { foo : \'bar\',\n\
                                  baz : \'baf\' } ));',

		server : '\
package Hello;\n\
use base \'Yote::AppRoot\';\n\
\n\
sub hello {\n\
  my( $self, $name ) = @_;\n\
  return "Hello \'$name\'";\n\
}\n\
sub list_length {\n\
  my( $self, $list ) = @_;\n\
  return "The input list is " . scalar( @$list ). "items long";\n\
}\n\
sub hash_keycount {\n\
  my( $self, $hash ) = @_;\n\
  return "The hash has " . scalar( keys %$hash ). "keys";\n\
}',
		discussion : 'This kata shows how to pass inputs to perl app methods from the client side. Shown here is passing scalar, list, and hash input types. Not shown is passing yote objects as parameters.',
		server_discussion : 'The second element of the @_ input array is always a reference to any data passed in, or undef if none was.',
		client_discussion : ''
	    },

	    // ******************* HELLO ACCOUNT *****************
	    {
	    title             : 'Hello Account',
	    summary           : 'Create and use an account',
	    client            : '\
$.yote.init();\n\
\n\
$.yote.create_login(\n\
       "Programmer",\n\
       "isEncryptedOnServer",\n\
       "coyocanid@gmail.com" );\n\
$.yote.login(\n\
       "Programmer",\n\
       "isEncryptedOnServer" );\n\
var hello_app = $.yote.fetch_app(\'Hello\');\n\
alert( hello_app.hello(&quot;Hi there&quot;) );',
	    server            : '\
package Hello;\n\
use base \'Yote::AppRoot\';\n\
\n\
sub hello {\n\
    my( $self, $value, $account ) = @_;\n\
    return $value . &quot;, " . $account->get_handle();\n\
}',
	    discussion        : 'An account is just a bundle of data associated with a user and an app. The same user will have an account for each different app on the system.',
	    server_discussion : 'The account object is always passed as the third parameter to any yote method if a user is logged in.',
	    client_discussion : 'Methods for logging in and creating accounts are provided.'
	}
	];

	var page_counter = $.yote.fetch_app('Yote::Util::Counter');
	page_counter.increment( 'Quickstart Page',
				function( count ) {
				    $('#counter').empty().append( count );
				},
				function( err ) {
				    msg( err );
				},
				1 );

	var buf = '';
	for( var i=0; i < lessons.length; i++ ) {
	    var lesson = lessons[ i ];
	    buf += '<LI id="li_' + i + '"><A HREF="#" id="lesson_' + i + '"> ' +
		lesson[ 'title' ] + '</LI>';
	}
	
	$( '#navcol' ).empty().append( buf );
	for( var i=0; i < lessons.length; i++ ) {
	    $( '#lesson_' + i ).click( (function(ii) { 
		return function() {
		    show_lesson( ii );
		} 
	    } )( i ) );
	}

	function show_lesson( lesson_idx ) {
	    var lesson = lessons[ lesson_idx ];
	    $( '#navcol li' ).removeClass( 'active' );
	    $( '#li_' + lesson_idx ).addClass( 'active' );
	    if( ! lesson ) {
		return;
	    }
	    var buf = '<DIV class="page-header"><h3>' +
		lesson[ 'title' ] + '</h3>' + lesson[ 'summary' ] + '</DIV>' +
		'<table class="lesson">' +
		'<tr><th>Server Side</th><th>Client Side</th></tr>' +
		'<tr id="lrow"><td><div><pre><code>' + lesson[ 'server' ] + '</code></pre></div></td>' +
		'<td><div><pre><code>' + lesson[ 'client' ] + '</code></pre></div></td>' +
		'</table>';
	    if( lesson[ 'server_discussion' ] ) {
		buf += '<p><h4>Server Notes</h4>' + lesson[ 'server_discussion' ] + '</p>';
	    } 
	    if( lesson[ 'client_discussion' ] ) {
		buf += '<p><h4>Client Notes</h4>' + lesson[ 'client_discussion' ] + '</p>';
	    } 
	    if( lesson[ 'discussion' ] ) {
		buf += '<p><h4>Discussion</h4>' + lesson[ 'discussion' ] + '</p>';
	    }
	    buf += '<div style="padding:0 300px 0 300px">';
	    if( lesson_idx > 0 ) {
		// can move backwards
		buf += '<a id="back" href="#">BACK</a>';
	    }
	    if( lesson_idx < (lessons.length-1) ) {
		// can move forwards
		buf += '<a id="ahead" href="#" style="float:right">AHEAD</a>';
	    }
	    buf += '</div>';

	    $( '#lesson' ).empty().append( buf );
	    $( '#lesson pre' ).height( $( '#lrow' ).height() );

	    $( '#back' ).click( (function(newidx) { 
		return function() { show_lesson( newidx ); }
	    } )( lesson_idx - 1 ) );

	    $( '#ahead' ).click( (function(newidx) { 
		return function() { show_lesson( newidx ); }
	    } )( lesson_idx + 1 ) );

	} //show_lesson

	show_lesson( 0 );
    });
    </script>
  </head>

  <BODY>

    <DIV class="navbar navbar-fixed-top navbar-inverse" style="position:fixed; height:70px;">
      <DIV class="navbar-inner">
	<A class="brand"><img src="yotelogo.png"></A>
	<UL id="top_nav" class="nav">
	</UL>
      </DIV>
    </DIV>

    <DIV class="">
      <h1>Quickstart</h1>
      <p>These excersizes are designed to show one concept at a time in order to learn the ins and outs of programming Yote. For the server side examples, the package is expected to be in the classpath used by Yote. For the client side examples, the appropriate javascript files are expected to be included.</p>
    </DIV>

    <DIV class="container">
      <DIV class="row">
	<DIV class="span2" id="navi">
	  <UL id="navcol" class="nav nav-list">
	  </UL>
	</DIV>

	<DIV class="span10">
	  <SECTION id="lesson">
	  </SECTION>
	</DIV>
      </DIV>
    </DIV>
<!--


<h3>Hello Environment</h3>
    <table width="768" height="154" border="0" class="content">
      <tr>
        <th>Server Side</th>
        <th>Client Side</th>
      </tr>
      <tr>
        <td width="354"><pre><code>package Hello;
use base 'Yote::AppRoot';

sub hello {
my( $self, $value, $account, $env ) = @_;
my $from_ip =       $env-&gt;{ REMOTE_ADDR };
    return $value . &quot;, " . $account->get_handle() . "from $from_ip";
} </code></pre></td>
        <td width="358"><pre><code>$.yote.init();

$.yote.create_login(
       "Programmer",
       "isEncryptedOnServer",
       "coyocanid@gmail.com" );
$.yote.login(
       "Programmer",
       "isEncryptedOnServer" );
var hello_app = $.yote.fetch_app('Hello');
alert( hello_app.hello(&quot;Hi there&quot;) );</code></pre></td>
      </tr>
    </table>


<h3>Hello Variables</h3>
    <table width="768" height="154" border="0" class="content">
      <tr>
        <th>Server Side</th>
        <th>Client Side</th>
      </tr>
      <tr>
        <td width="354"><pre><code>package Hello;
use base 'Yote::AppRoot';

sub hello {
    my( $self, $value, $account, $env ) = @_;
    my $from_ip =       $env-&gt;{ REMOTE_ADDR };
    $self->set_count(  $self->get_count( 0 ) + 1 );
    return $value . &quot;, &quot; . $account->get_handle() . "from $from_ip";
}

sub give_hash {
  my( $self, $hash ) = @_;
  return $hash-&gt;{foo};
}

sub count_list {
  my( $self, $list ) = @_;
  return scalar( @$list );
}
sub update_list {
  my( $self, $item_to_add ) = @_;
  $self-&gt;add_to_my_list( $item_to_add );
}</code></pre></td>
        <td width="358"><pre><code>$.yote.init();

$.yote.create_login(
       "Programmer",
       "isEncryptedOnServer",
       "coyocanid@gmail.com" );
$.yote.login(
       "Programmer",
       "isEncryptedOnServer" );
var hello_app = $.yote.fetch_app('Hello');
alert( hello_app.hello(&quot;Hi there&quot;) );
alert( "Hello app has said hello" +
             hello_app.get_count() );
alert( &quot;foo is &quot; +
       hello_app.give_hash( { foo : 'bar', baz : 'baf' } );
alert( &quot; array has &quot; +
        hello_app.count_list( [ &quot;A&quot;, &quot;B&quot;, &quot;C&quot; ] +
       &quot; items &quot; );

hello_app.update_list( &quot;Bigfoot&quot; );
hello_app.update_list( &quot;Sasquatch&quot; );
hello_app.update_list( &quot;Yeti&quot; );
alert( hello_app.get_my_list().get( 1 );
/* <strong>Very important to note :</strong>
   The objects that yote
   returns as lists are not javascript arrays.
   their length is obtained by calling the length()
   method. Their fields are accessed by get( index ).
</code>*/</pre></td>
      </tr>
    </table>


<h3>Hello Init</h3>
    <table width="768" height="154" border="0" class="content">
      <tr>
        <th>Server Side</th>
        <th>Client Side</th>
      </tr>
      <tr>
        <td width="354"><pre><code>package Hello;
use base 'Yote::AppRoot';

#
# _init is called when the object is first created.
#    note that methods that begin with underscores are not accessable from the client.
sub _init {
   my $self = shift;
   $self->set_my_hash( {  foo    => "BAR",
                          llamas => [ "Like", "To", "Play", "With", "Twigs" ],
                          store  => { AnObject => new Yote::Obj(),
                                      ANumber  => 22,
                                    },
                       } );
   $self->get_my_hash()->{ store }->{ AnObject }->set_flavor( "blueberry" );
}

</code></pre></td>
        <td width="358"><pre><code>$.yote.init();

var hello_app = $.yote.fetch_app('Hello');

alert( hello_app.get_my_hash().get( 'store' ).get( 'An_Object' ).get_flavor() );
/* <strong>Very important to note :</strong>
   The objects that yote
   returns as lists are not javascript arrays.
   their length is obtained by calling the length()
   method. Their fields are accessed by get( index ).
</code>*/</pre></td>
      </tr>
    </table>

	  <SECTION id="hello" style="height : 900px; background-color:pink">
	    <DIV class="container">
	      <DIV class="row">
		<DIV class="span6">
		  <h3>Server Side</h3>
		  <DIV class="server_side">
		    bla
		  </DIV>
		</DIV>
		<DIV class="span6">
		  <h3>Client Side</h3>
		  <DIV class="client_side">
		    woa
		  </DIV>
		</DIV>
	      </DIV>
	    </DIV>
	  </SECTION>
	  <SECTION id="bar" style="height : 900px; background-color:blue">
	    <DIV class="container">
	      <DIV class="row">
		<DIV class="span6">
		</DIV>
		<DIV class="span6">
		</DIV>
	      </DIV>
	    </DIV>

	  </SECTION>
	</DIV>
      </DIV>
    </DIV>
-->
    <footer>
      This page has been viewed <span id="counter"></span> times.
    </footer>
    <script src="/js/bootstrap.js"></script>
    <script src="/js/local.js"></script>
</body>
</html>
