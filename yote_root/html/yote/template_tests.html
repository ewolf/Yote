<!DOCTYPE html>
<html>
<head>
<title>Yote Template Tests</title>

<style>
 .fail { color:red }
 .pass { color:green }
 body { background-color:wheat }
 .hide { display:none }
</style>

<script src="/yote/js/jquery-2.1.0.js"></script>
<script src="/yote/js/jquery.base64.min.js"></script>
<script src="/yote/js/jquery.cookie.js"></script>
<script src="/yote/js/json2.js"></script>
<script src="/yote/js/yote.js"></script>
<script src="/yote/js/yote.templates.js"></script>

<script src="/templates/default_templates.js"></script>

<script>
    <!--
var tests = 0;
var failed = 0;
var calls_made = 0;
$.yote.old_message = $.yote.message;
$.yote.message = function( params ) {
    calls_made++;
    return $.yote.old_message( params );
}


function fail( test ) {
    return function(d) {
        ++failed;
        ++tests;
        $('#tests').append( "<span class=fail>FAILED : </span>" + test + '<BR>' );
    }
}
function pass( test ) {
    return function(d) {
        ++tests;
        $('#tests').append( "<span class=pass>PASSED : </span>" + test + '<BR>' );
    }
}
function msg( txt ) {
    $('#tests').append( txt + '<BR>' );
}
function is( result, expected, msg ) {
    if( result === expected ) {
 	pass( msg )();
    }
    else {
 	fail( msg + "( expected '" + expected + "' and got '" + result +"')" )();
    }
}
function ok( result, msg ) {
    if( result === true ) {
 	pass( msg )();
    }
    else {
 	fail( msg )();
    }
}
function wrap_up() {
    $( '#results' ).append( "<BR>Calls made " + calls_made + "<BR>" );
    if( failed > 0 ) {
        $('#results').append( "Failed " + failed + " tests out of " + tests );
    } else {
        $('#results').append( "Passed all " + tests + " tests" );
    }
    var d = new Date();
    var t2 = d.getTime();
    var d2 = new Date();
    $('#tests').append( "<br>tests completed in " + Math.round(d2.getTime() - t2) + " ms" );
} //wrap_up
var step_count = 0;
function step( msg ) {
    console.log( "step " + step_count + ':' + msg  );
    step_count++;
}
$().ready(function(){
    /*
       Test the following template parts

	        <# comments go here #>

	        <??? function( ctx ) ...
		    - test ability to set values in the context
		    - test ability to return other filled in templates

	        <$$$ function foo( ctx ) ...
	        <$$$ var varname value $$$>
	        <$$$ value varname function( ctx ) ...
	        <?? function( ctx ) ....
	        <$$ template 
	        <@ template list max_rows @>
	        <% template list max_rows %>
	        <$ show var $>
	        <$ show var $>
	        <? function( ctx ) ... ( after render )


      */
    $.yote.include_templates( '/templates/default_templates.html' );
    $.yote.templates.register_functions( base_templates );

    function do_tests() {
        // init yote
        var app = $.yote.init('Yote::Test::Template');
        $.yote.logout();
        $.yote.reinit();
        $.yote.debug = true;

 	try {
	    app.reset();
	    var sandbox = app.get_sandbox();
	    $.yote.templates.refresh_ui();
	    
	    is( $( '#comments' ).html().trim(), 'This template has comments', '<# comment template #>' );
	    is( $( '#comments' ).html().trim(), 'This template has comments', 'automatic filling of template variables' );
	    is( $.yote.templates.fill_template( 'Comments' ).trim(), 'This template has comments', '$.yote.templates.fill_template works' );
 	}
 	catch( err ) {
 	    fail( err )();
 	    wrap_up();
 	}
 	wrap_up();

    } //do_tests
    do_tests();
} ); //ready
-->
</script>

</head>

<script type="text/template" class="yote_template_definition" template_name="SimpleTemplate">
  A very simple test
</script>

<script type="text/template" class="yote_template_definition" template_name="Comments">
    This template<# doesn't #> has comments <# I'd say #>
</script>

<body>
  <h1>Yote Template Tests</h1>
  <div  id="comments" class="yote_template hide" template="Comments"></div>

  <div id="tests"></div>
  <div id="results"></div>
</body>
</html>
