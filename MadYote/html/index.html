<HTML>
  <head>
    <title></title>
    <script src="/yote/js/jquery-latest.js"></script>
    <script src="/yote/js/jquery.cookie.js"></script>
    <script src="/yote/js/jquery.base64.min.js"></script>
    <script src="/yote/js/json2.js"></script>

    <script src="/js/main.js"></script>
    <script src="/yote/js/yote.js"></script>
    <script src="/yote/js/yote.util.js"></script>
    <link href="/yote.css" rel="stylesheet" type="text/css" media="all" />
    <link href="/css/main.css" rel="stylesheet" type="text/css" media="all" />

    <STYLE>
      .page_panel { width : 800px; background-color: rgb(79, 153, 88); margin-left: 300px; }
      .side_panel { float: left; padding: 15px; margin: 100px 4px 0px 4px; max-width: 262px; }
      .mainpanel { top:0px; width:500px; display:inline-block; }
      .chatbar   { top:0px; width:200px; display:inline-block; vertical-align:top; margin : 10px; padding : 10px }
      body       { margin-top:70px }
      .news_time { font-family: monospace;
                   font-size: small; }
      .news_body { font-family: serif; margin-left: 10px; padding-left: 10px; }
      .news_header{ font-family: sans-serif;
                    font-style: italic;
                    font-size: large; margin-top: 3px; margin-bottom: 3px; }

    </STYLE>

    <script>
      <!--
/*
  One could, for example have templates. One template for the frame of the page, one for the javascript
  and one each for the panels.

  Now what would the template look like?


*/
	  $().ready(function() {
//	      console.log( ['EXTRA',$('#extra'),$('#extra').attr('foo')] );return;
	      $.yote.init();

	      

	      var yote_app = $.yote.fetch_app( 'MadYote' );
	      var root = $.yote.fetch_root();
	      
	      $.yote.util.register_items( { 
		  box  : yote_app.get_suggestion_box(),
		  chat : yote_app.get_chat(),
	      } );


	      function setup() {
		  $.yote.util.init_ui();

		  //url params to get current page
		  var pagename = 'index.html';
		  var page = yote_app.hash_fetch( { name : 'pages', key : pagename } );
		  if( $.yote.is_root() ) {
		      if( ! page ) {
			  page = yote_app.hash( { name : 'pages',  key : pagename, value : $.yote.fetch_root().new_root_obj() } );
		      }
		      $( '#mainpanel' ).empty().append( $.yote.util.prep_edit( page, 'main_panel' ) );
		      $.yote.util.implement_edit( page, 'main_panel' );
		      $( '#side_panel' ).empty().append( $.yote.util.prep_edit( page, 'side_panel' ) );
		      $.yote.util.implement_edit( page, 'side_panel' );
		  }
		  else {
		      if( !page ) { page = { get : function() { return '' } }; }
		      $( '#mainpanel' ).empty().append( page.get( 'main_panel' ) || '' );
		      $( '#side_panel' ).empty().append( page.get( 'side_panel' ) || '' );
		      $( '#suggestion_box' ).empty().append(
			      '<TEXTAREA id="suggestion" placeholder="Suggestion Box"></TEXTAREA><BR>' +
			      '<BUTTON type="BUTTON" id="suggest_b">Send</BUTTON>' +
			      '<DIV id="suggestion_msg"></DIV>'
		      );
		      $( '#suggest_b' ).click(function() {
			  var sug =  $( '#suggestion' ).val();
			  var sug_obj = $.yote.fetch_root().new_obj();
			  sug_obj.set( 'suggestion', sug );
			  box.add_to( { name : 'suggestions', items : [ sug_obj ] } );
			  $( '#suggestion_msg' ).empty().append( 'Added suggestion : ' + sug );
		      } );
		  }

/*		  var chat_table = $.yote.util.control_table( {
		      attachpoint : '#chat_box',
		      item : yote_app.get_chat(),
		      list_name : 'messages',
		      show_count : false,
		      include_remove : $.yote.is_root(),
		      columns : [
			  function( item, is_prep ) {
			      if( is_prep ) {
				  return item.get_message() + '[' + item.get_name() + '] (' + new Date(1000*item.get_created_on()).toLocaleString() + ')';
			      }
			  }
		      ],
		      after_new_function : function( item ) {
			  item.set( 'created_on', Math.round( new Date().getTime() / 1000 ) );
		      },
		      new_button : 'Say',
		      new_attachpoint : '#chat_mgs',
		      new_columns :  [
			  'message',
			  'name'
		      ],
		      new_column_placeholders : [ 'message', 'name' ],
		  } );
*/
	      } //setup

	      attach_login( {
		  attachpoint         : '#logged_in_status',
		  message_attachpoint : '#msg_div',
		  after_login         : function() {
		      setup();
		  },
		  after_logout        : function() {
		      setup();
		  }
	      } );
	  } );
	-->
    </script>

  </head>


  <body>
    <DIV class="header" id="header_div">
      <A href="/index.html" style="display:block">
        <img height="70px" width="151px" src="yotelogo.png">
      </A>
      <UL id="top_nav" class="nav"></UL>
      <DIV class="login logged_in" id="logged_in_status"></DIV>
      <DIV id="msg_div"></DIV>
    </DIV>
    <DIV id="side_panel" class="side_panel">
    </DIV>
    <DIV class="page_panel">
      <DIV id="mainpanel" class="mainpanel">
      </DIV>
      <DIV class="chatbar">
	<DIV id="suggestion_box"></div>
	<DIV class="control_table" id="suggestion_box_admin" is_admin="true"
	     item="$box" list_name="suggestions", include_remove="true", column_headers="['Suggestion','Notes']"
	     columns="['suggestion','*notes']" ></div>
	<div id="suggestion_box">
	</div>
	<HR>
        <h3>Chat</h3>
        <div id="chat_mgs"></div>
	<div class="control_table" id="chat_box" item="$chat"
	     list_name="messages" show_count="false" include_remove="*$.yote.is_root()"
	     columns="[function(item,is_prep){if(is_prep){return item.get_message()+'['+item.get_name()+'] ('+new Date(1000*item.get_created_on()).toLocaleString()+')'}}]"
	     aafter_new_function="*function(item){ item.set('created_on',Math.round( new Date().getTime()/1000)) }"
	     after_new_function="*function(){}"
	     new_button="say" new_attachpoint="#chat_mgs" 
	     new_columns="['message','name']" new_column_placeholders="['message','name']"
	     ></div>
      </DIV>
    </DIV>
    <DIV id="extra" foo="BAR"></DIV>
  </body>

</HTML>
