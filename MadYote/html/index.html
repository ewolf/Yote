<HTML>
  <head>
    <title></title>
    <script src="/yote/js/jquery-latest.js"></script>
    <script src="/yote/js/jquery.cookie.js"></script>
    <script src="/yote/js/jquery.base64.min.js"></script>
    <script src="/yote/js/json2.js"></script>

    <script src="/js/main.js"></script>
    <script src="/yote/js/yote.js"></script>
    <script src="/yote/js/yote.util.js"></script>
    <link href="/yote.css" rel="stylesheet" type="text/css" media="all" />
    <link href="/css/main.css" rel="stylesheet" type="text/css" media="all" />

    <STYLE>
      .page_panel { width : 800px; background-color: rgb(79, 153, 88); margin: auto; }
      .mainpanel { top:0px; width:500px; display:inline-block; }
      .chatbar   { top:0px; width:200px; display:inline-block; vertical-align:top; margin : 10px; padding : 10px }
      body       { margin-top:70px }
      .news_time { font-family: monospace;
                   font-size: small; }
      .news_body { font-family: serif; margin-left: 10px; padding-left: 10px; }
      .news_header{ font-family: sans-serif;
                    font-style: italic;
                    font-size: large; margin-top: 3px; margin-bottom: 3px; }

    </STYLE>

    <script>
      <!--
/* 
  One could, for example have templates. One template for the frame of the page, one for the javascript
  and one each for the panels.

  Now what would the template look like?

   
*/
	  $().ready(function() {
	      $.yote.init();
	      var yote_app = $.yote.fetch_app( 'MadYote' );
	      var root = $.yote.fetch_root();

	      var chat_table = $.yote.util.control_table( {
		  attachpoint : '',
		  item : yote_app.get_chat(),
		  list_name : 'foo',
		  columns : [
		      
		  ],
		  new_attachpoint : '#chat_mgs',
		  new_columns : [
		      
		  ]
		  new_column_placeholders : [],
	      } );

	      function display_page( page_key, admin_mode ) {
		  var page, body_html, header_html;
		  var pages = yote_app.get_hash_handle( 'pages' );
		  if( pages ) {
		      page = pages.get( page_key );
		      if( page ) {
			  body_html = page.get('body_html');
			  header_html = page.get('header_html');
		      }
		  }
		  var default_body = 'NO PAGE DEFINED';
		  var default_header = '<A href="/index.html" style="display:block">' +
		      '  <img height="70px" width="151px" src="yotelogo.png">' +
		      '</A>' +
		      '<UL id="top_nav" class="nav"></UL>' +
		      '<DIV class="login logged_in" id="logged_in_status"></DIV>' +
		      '<DIV id="msg_div"></DIV>';

		  if( $.yote.is_root() ) {
		      if( ! page ) {
			  page = pages.set( page_key, root.new_root_obj() );
		      }
		      if( ! body_html )
			  body_html = page.set( 'body_html', default_body );
		      if( ! header_html )
			  header_html = page.set( 'header_html', default_header );
		      
		      // should write the admin control panel here.
		      if( admin_mode ) {
			  $( '#header_div' ).removeClass( 'header' );
			  try {
			      $( '#body_div' ).empty().append( 'Edit the Body <BR>' + $.yote.util.prep_edit( page, 'body_html' ) );
			  }
			  catch( err ) {
			      $( '#body_div' ).empty().append( 'Edit the Body <BR>' + $.yote.util.prep_edit( page, 'body_html', false, true ) );
			  }

			  try {
			      $( '#header_div' ).empty().append( 'Edit the Header <BR>' + $.yote.util.prep_edit( page, 'header_html' ) );
			  }
			  catch( err ) {
			      $( '#header_div' ).empty().append( 'Edit the Header <BR>' + $.yote.util.prep_edit( page, 'header_html', false, true ) );
			  }
			  $( '#header_div' ).append( '<BR><A href="#" id="leave_admin">Stop Editing</A>' );
			  $.yote.util.implement_edit( page, 'header_html' );
			  $.yote.util.implement_edit( page, 'body_html' );
			  $( '#leave_admin' ).click(function(){
			      display_page( page_key, false );
			  });
		      }
		      else {
			  $( '#header_div' ).addClass( 'header' );
			  $( '#header_div' ).empty().append( header_html );
			  $( '#body_div' ).empty().append( body_html );			  
		      }
		  } //is root
		  else {
		      if( ! body_html ) {
			  body_html = default_body;
			  header_html = default_header;
		      }
			  console.log( "XX" );
		      $( '#header_div' ).empty().append( header_html );
		      $( '#body_div' ).empty().append( body_html );
		  }

		  (function ( was_logged_in, was_root ) {
		      attach_login( {
			  attachpoint         : '#logged_in_status',
			  message_attachpoint : '#msg_div',
			  after_login         : function() {
			      if( ! was_logged_in || was_root != $.yote.is_root() ) {				  
				  display_page( page_key );
			      }
			      if( $.yote.is_root && $( "#go_admin" ).length == 0  ) {
				  $( '#logged_in_status' ).append( '<BR><a href="#" id="go_admin">Admin Page Edit</a>' );
				  $( '#go_admin' ).click(function() {
				      display_page( page_key, true );
				  } );
			      }
			  },
			  after_logout        : function() {
			      if( was_logged_in ) {
				  display_page( page_key );
			      }
			  }
		      } )
		  } )( $.yote.is_logged_in(), $.yote.is_root() );
	      } //display_page

	  } );
	-->
    </script>

  </head>


  <body>
    <DIV class="header" id="header_div"></DIV>
    <DIV class="page_panel">
      <DIV class="mainpanel">
	      BLABLABLA
      </DIV>
      <DIV class="chatbar">
	<div id="suggestion_box">
	  <TEXTAREA id="suggestion" placeholder="Suggestion Box"></TEXTAREA><BR>
	  <BUTTON type="BUTTON" id="place_suggestion">Send</BUTTON>
          <DIV id="suggestion_msg"></DIV>
	</div>
	<BR>
        <div id="chat_mgs"></div>
	<div id="chat_box"></div>
      </DIV>
    </DIV>

  </body>

</HTML>
